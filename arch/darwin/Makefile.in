#
# OS X makefile generics
#

STRIP   ?= strip

ifeq (${ARCH},i686)
CC        := i686-apple-darwin9-gcc-4.0.1 -mmacosx-version-min=10.3
CXX       := i686-apple-darwin9-g++-4.0.1 -mmacosx-version-min=10.3
REAL_ARCH := i686
else ifeq (${ARCH},amd64)
CC        := i686-apple-darwin9-gcc-4.0.1 -m64 -mmacosx-version-min=10.5
CXX       := i686-apple-darwin9-g++-4.0.1 -m64 -mmacosx-version-min=10.5
REAL_ARCH := amd64
else ifeq (${ARCH},ppc)
CC        := powerpc-apple-darwin9-gcc-4.0.1 -mmacosx-version-min=10.3
CXX       := powerpc-apple-darwin9-g++-4.0.1 -mmacosx-version-min=10.3
REAL_ARCH := ppc
else ifeq (${ARCH},ppc64)
CC        := powerpc-apple-darwin9-gcc-4.0.1 -m64 -mmacosx-version-min=10.4
CXX       := powerpc-apple-darwin9-g++-4.0.1 -m64 -mmacosx-version-min=10.4
REAL_ARCH := ppc64
else
REAL_ARCH := $(error Invalid architecture selection)
endif

DSOLDFLAGS = -dynamiclib
DSOPRE     = lib
DSOPOST    = .dylib
DSORPATH   =
DSOSONAME  = -install_name @executable_path/

SDL_CFLAGS  = -I${PREFIX}/SDL.Framework/Headers
SDL_LDFLAGS = -framework SDL

LIBPNG_CFLAGS  = -I${PREFIX}/libpng.Framework/Headers
LIBPNG_LDFLAGS = -framework libpng

VORBIS_CFLAGS  = -I${PREFIX}/Ogg.Framework/Headers \
                 -I${PREFIX}/Vorbis.Framework/Headers
VORBIS_LDFLAGS = -framework Ogg -framework Vorbis

ARCH_LDFLAGS = -F/Users/ajs/workspace/Frameworks

arch/darwin/SDLMain.o: arch/darwin/SDLMain.m
	$(if ${V},,@echo "  CC      " $<)
	${CC} -MD ${CFLAGS} ${SDL_CFLAGS} -c $< -o $@

package:
	@mv ${core_target} ${core_target}.${REAL_ARCH}
	@mv ${editor_target} ${editor_target}.${REAL_ARCH}
	@mv ${network_target} ${network_target}.${REAL_ARCH}
	@mv ${mzx} ${mzx}.${REAL_ARCH}
	@mv ${mzxrun} ${mzxrun}.${REAL_ARCH}
	@mv ${updater} ${updater}.${REAL_ARCH}

clean:
	@echo "  CLEAN   " arch/darwin
	@rm -f arch/darwin/SDLMain.o arch/darwin/SDLMain.d
